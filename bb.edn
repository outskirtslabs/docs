{:paths ["scripts"]
 :deps {borkdude/rewrite-edn {:mvn/version "0.4.9"}}
 :tasks
 {:requires ([babashka.tasks :refer [shell]]
             [tasks :as tasks]
             [setup-webhook :as setup-webhook])

  build
  {:doc "Full build: generate home catalog, bundle UI, and build site with Antora."
   :task (shell "bash scripts/build.sh playbook.yml")}
  build:theme
  {:doc "Build just the Antora UI theme bundle."
   :task (shell "bash -lc \"cd ui && node scripts/build-ui.mjs bundle\"")}
  serve
  {:doc "Serve the built site locally with nginx."
   :task (shell "bash scripts/nginx-dev.sh foreground")}
  dev
  {:doc "Run docs dev mode with watching, auto rebuild, and live reload."
   :task (shell "bash scripts/dev.sh")}
  projects.nix
  {:doc "Update pkgs/projects.nix from configured project URLs."
   :task (tasks/update-projects)}
  bb-tasks:sha
  {:doc "Update outskirtslabs/bb-tasks git sha in project bb.edn files."
   :task (apply tasks/update-bb-tasks-sha *command-line-args*)}
  webhook:setup
  {:doc "Create or update docs webhook. Usage: bb webhook:setup [owner/repo]"
   :task (apply setup-webhook/setup *command-line-args*)}
  webhook:remove
  {:doc "Delete docs webhook(s). Usage: bb webhook:remove [owner/repo]"
   :task (apply setup-webhook/remove-webhook *command-line-args*)}
  test
  {:doc "Run flake checks."
   :task (shell "nix flake check")}
  dist:prepare
  {:doc "Update npmDepsHash in pkgs/docs-site.nix."
   :task (tasks/dist-prepare)}
  dist
  {:doc "Build the docs site package via Nix."
   :depends [projects.nix dist:prepare test]
   :task (shell "nix build .#docs-site")}
  deploy
  {:doc "Deploy docs-site to james via deploy-rs."
   :task (shell "deploy --debug-logs --ssh-user root .#main")}
  test:arborium
  {:doc "Run arborium syntax highlighting tests."
   :task (shell "node --test scripts/highlight-arborium.test.mjs")}
  gen-home
  {:doc "Generate the home page project catalog partial from playbook sources + project manifests."
   :task (shell "bb scripts/gen_home.clj")}}}
